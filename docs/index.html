
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Creating your first iOS App</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="docs"
                  title="Creating your first iOS App"
                  environment="web"
                  feedback-link="https://github.com/zivz/WeatherApp">
    
      <google-codelab-step label="First iOS App Overview" duration="2">
        <p>In the following tutorial, we&#39;ll learn how to make an iOS app.</p>
<p><strong>General<br></strong> The app will show the user the current weather in its current location.</p>
<p><strong>UI<br></strong> The UI Will have a single view.<br> The primary view will contain two subviews:</p>
<ul>
<li>A view for the current weather</li>
<li>A table view for the next 10 days forecast.</li>
</ul>
<p><strong>API<br></strong> The app will interact with Open Weather API, in order to fetch the current weather, and the forecast.</p>
<p><strong>Location<br></strong> The app will fetch the user&#39;s location, upon <code>When in use authorization</code> permission</p>
<p><strong>Notes:</strong></p>
<ul>
<li>The tutorial will focus on Storyboards, Autolayout and UIStackView.<br></li>
<li>The tutorial will include the current weather view only<br></li>
<li>Location Handler, Networking, Parsing code will be provided in order to provide the full capabilities of the app.<br></li>
<li>The app is extendable for further implementation of the next 10 days forecast.<br></li>
<li>Tableview displaying the forecast for the next 10 days implementation is still available in github.<br></li>
<li>The full code is available <a href="https://github.com/zivz/WeatherApp" target="_blank">here</a>.<br></li>
</ul>
<p><strong>Resources:</strong></p>
<ul>
<li><a href="https://developer.apple.com/design/human-interface-guidelines/ios/overview/" target="_blank">Human Interface Guidelines</a></li>
<li><a href="https://www.youtube.com/watch?v=emojd8GFB0o" target="_blank">Autolayout</a> and <a href="https://www.youtube.com/watch?v=eF9Ut-VpdAI" target="_blank">StackView</a></li>
<li><a href="https://openweathermap.org/api" target="_blank">Open Weather API</a>.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Xcode - New Project" duration="4">
        <p>This tutorial assumes you have basic familiarity with Xcode, as provided in a separate session.</p>
<p><strong>Resources:</strong></p>
<ul>
<li><a href="https://apps.apple.com/il/app/xcode/id497799835?mt=12" target="_blank">Download Xcode from App Store</a></li>
<li><a href="https://www.youtube.com/watch?v=jniJeamcIUU" target="_blank">Xcode Essentials</a></li>
</ul>
<h3 is-upgraded>Create a new Xcode Project</h3>
<p>Open Xcode and select &#34;Create a new Xcode Project&#34;<br><img alt="Create a new Xcode Project" src="img/b739ac1bb07cc84d.png"></p>
<h3 is-upgraded>Choose a template for your new project with following options:</h3>
<p>iOS | Single View App<br><img alt="Choose a template" src="img/a6a446cee285a643.png"></p>
<h3 is-upgraded>Choose options for your new project:</h3>
<ul>
<li>Product Name - give a meaningful name such as <code>WeatherApp</code></li>
<li>Organization Name - give your Name or your organization Name</li>
<li>Organization identifier will be constructed from Organization Name</li>
<li>Bundle Identifier - will be constructed from your Product Name and Organization Name.</li>
<li>Language - Swift</li>
<li>User Interface - Choose Storyboard</li>
<li>Leave <code>User Core Data, Include Unit Tests and Include UI Tests</code><strong>Unchecked</strong></li>
</ul>
<p class="image-container"><img alt="Template Options" src="img/1bb6c1e94adb366e.png"></p>
<h3 is-upgraded>Edit and Verify Project Settings</h3>
<p>Once the project is created, The project file will appear on the screen. <strong>Under General tab verify the following:</strong></p>
<ul>
<li>Verify <code>Display Name, Bundle Identifier</code> are correct under <code>identity</code></li>
<li>Check <code>iPhone</code> only, under <code>Deployment info</code></li>
<li>Check <code>Portrait</code> only, under <code>Device Orientation</code></li>
</ul>
<p class="image-container"><img alt="Project Settings" src="img/6d51293211bb42b5.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Weather UI Overview" duration="0">
        <h3 is-upgraded>UI Components</h3>
<p>Our Primary View will contain 2 Subviews.</p>
<ul>
<li>Current Weather view</li>
<li>Table View with 10 days weather forecast, <strong>which will not be part of this tutorial.</strong></li>
</ul>
<p class="image-container"><img alt="WeatherApp Subviews" src="img/bc5e422b731ea0be.png"></p>
<h3 is-upgraded>Current Weather view</h3>
<p>Will be consisted of 2 parts</p>
<ul>
<li>Part 1 - General Info  <ul>
<li>Current date</li>
<li>Current Temperature in Celsius</li>
<li>Current Location</li>
</ul>
</li>
<li>Part 2 - Weather Description  <ul>
<li>An Image of Weather Type</li>
<li>Weather Description</li>
</ul>
</li>
</ul>
<p class="image-container"><img alt="Current Weather View" src="img/7bcaab022afac85c.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Current Weather UI Terminology" duration="0">
        <p>In this section we&#39;ll create the Current Weather UI, using Storyboard, Autolayout and StackView.</p>
<h3 is-upgraded>Storyboard</h3>
<p>From <a href="https://www.raywenderlich.com/5055364-ios-storyboards-getting-started" target="_blank">raywanderlich.com</a> - Storyboards are an exciting feature first introduced in iOS 5, which save time building user interfaces for your apps. Storyboards allow you to prototype and design multiple view controller views within one file, and also let you create transitions between view controllers.</p>
<p>From <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/Storyboard.html" target="_blank">apple.com</a> - A storyboard is a visual representation of the user interface of an iOS application, showing screens of content and the connections between those screens.</p>
<h3 is-upgraded>Autolayout</h3>
<p>From <a href="https://www.raywenderlich.com/811496-auto-layout-tutorial-in-ios-getting-started" target="_blank">raywanderlich.com</a> - At first, Apple made one screen size for the iPhone. Developers didn&#39;t have to create flexible interfaces as they only had to fit that one size. Today, differently sized devices and more emphasis on landscape mode demand user interfaces of different sizes. Auto Layout is Apple&#39;s solution to this problem, enabling UI elements to grow, shrink and move depending on screen size. Auto Layout makes it easy to support different screen sizes in your apps.</p>
<h3 is-upgraded>Constraints</h3>
<p>From <a href="https://www.avanderlee.com/swift/auto-layout-programmatically/" target="_blank">SwiftLee</a> - Auto Layout constraints allow us to create views that dynamically adjust to different size classes and positions. The constraints will make sure that your views adjust to any size changes without having to manually update frames or positions</p>
<h3 is-upgraded>UIStackview</h3>
<p>From <a href="https://developer.apple.com/documentation/uikit/uistackview" target="_blank">apple.com</a> - Stack views let you leverage the power of Auto Layout, creating user interfaces that can dynamically adapt to the device&#39;s orientation, screen size, and any changes in the available space. The stack view manages the layout of all the views in its arrangedSubviews property. These views are arranged along the stack view&#39;s axis, based on their order in the arrangedSubviews array. The exact layout varies depending on the stack view&#39;s axis, distribution, alignment, spacing, and other properties. <img alt="Stack view - Apple developer" src="img/580d5a03d8d3c6d1.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Creating the basic view" duration="0">
        <p>As seen in the image capture below, <strong>Current Weather View</strong> and <strong>Weather Forecast (table) view</strong> are two separate views in the view hold by the view controller.</p>
<p><img alt="WeatherApp Subviews" title="Current Weather View and Forecast Table View" src="img/bc5e422b731ea0be.png"><br> We&#39;ll create this view and later pile up our detailed UI Elements.</p>
<p>We&#39;re basically going to add the blue view, holding our detailed UI Elements as in the 3d capture below. <img alt="Current Weather 3D Capture" title="Current Weather 3D Capture" src="img/bb87a7126996f47.png"></p>
<p>In order to do so, follow the following steps:</p>
<ol type="1">
<li>open Main.storyboard  <ol type="1">
<li>You should currently see a View inside the View Controller hierarchy.<br><img alt="View Controller Scene" title="View Controller Scene" src="img/775024cb69f1b752.png"></li>
</ol>
</li>
<li>Tap on the <code>+</code> Button in the right top corner, in order to reveal the <code>Object Library</code><br><ol type="1">
<li>Search for <code>View/UIView</code> and drag it beneath the View.<br><img alt="View" src="img/450dc6793227e07d.png"><br></li>
<li>You should currently have a view inside your previous view.<br><img alt="Adding a view" title="Adding a view" src="img/868554642207f3ad.png"></li>
</ol>
</li>
</ol>
<h2 is-upgraded>Setting our view constraints</h2>
<p><strong>Before we start follow the steps below, that we&#39;ll help us figure out how view looks like:</strong></p>
<ul>
<li>Go to the view attributes, and set its color to <code>System Teal Color</code>.<br><img alt="Current Weather View Teal Color" title="Current Weather View Teal Color" src="img/96ed9caf91abdc96.png"></li>
<li>change the View name to a meaningful name such as <code>Current Weather View</code><img alt="Current Weather View Rename" src="img/d518c5e61666de7e.png"></li>
<li>Run the application and verify your changes.</li>
</ul>
<aside class="warning"><p><strong>Notice</strong>: there&#39;s a red arrow indicating a problem with your view since it has no set of rules,<br><img alt="Missing Constraints" title="Missing Constraints" src="img/f64076e9ce0d8b74.png"><br> In other words we need to <code>Add constraints</code> so <code>Autolayout</code> will figure out where to position the Current weather view.</p>
</aside>
<p>In order for our view to be adaptive, we need to set some rules so it will fit several devices:</p>
<ul>
<li>Click on Add New Constraints Button<br><img alt="Add New Constraints" title="Add New Constraints" src="img/ba7f5f7d6bfff167.png"></li>
<li>Pin the view to the top, leading and trailing edges.</li>
<li>Add a height of 300.</li>
<li>Click on Add 4 New Constraints<br><img alt="Add 4 Constraints" title="Add 4 Constraints" src="img/b47568bbc1c97ff7.png"></li>
<li>Verify The Missing Constraints error is gone</li>
<li>Build and run your app.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Adding Current Weather - General Info UI Elements" duration="0">
        <p>We&#39;ll add the items as in the image below.<br><img alt="CurrentWeather-GeneralInfo" src="img/e6d2131d0b029568.png"></p>
<p>Follow these steps in order to add the items:</p>
<ul>
<li>Step 1: In Object Library (<code>+</code> Button) Search For an Image: <img alt="CurrentWeather-Image" src="img/824f0890ca9139fd.png"></li>
<li>Step 2: Drag the label under the blue view we&#39;ve previously created.</li>
<li>Step 3: Copy and Paste The Label Twice, so you&#39;ll end up with 3 Labels.</li>
<li>Step 4: By clicking on the Labels give them meaningful names:  <ul>
<li><code>Current Date</code> for the top label</li>
<li><code>Current Temp</code> for the middle Label</li>
<li><code>Current Location</code> for the bottom Label</li>
</ul>
</li>
<li>Step 5: Your Interface builder should look like that<br><img alt="CurrentWeather-GeneralInfoItems" src="img/fc44ecc2f25f634e.png"></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Creating Current Weather - General Info Stackview" duration="0">
        <p>As specified in Weather UI overview, the current weather UI will be consisted of two views. Those Views are marked in the image below in red, and green. The red view refers to the General Info View, while the green view refers to the weather description view.</p>
<p class="image-container"><img alt="Current Weather View" title="Current Weather View" src="img/7bcaab022afac85c.png"></p>
<p>Using Stack Views will ease our development process, simplify our constraints logic and will be easier if we&#39;ll want to make changes in our UI in the future. Using Stack Views comes naturally as one view, can be &#34;treated&#34; as an array of 3 vertical elements, while the other has 2 vertical elements.</p>
<aside class="warning"><p>As Stack Views are really confusing in the beginning, play with the different options<br> other than those suggested in the paragraph below, In order to notice the difference.</p>
</aside>
<h3 is-upgraded>The Current Weather General Info Stack View Properties</h3>
<ul>
<li>Axis - As Our elements are stacked vertically, we&#39;ll choose <code>Vertical</code>.</li>
<li>Alignment - We&#39;d like our elements to fill the container, we&#39;ll choose <code>Fill</code>.</li>
<li>Distribution - We&#39;d like our elements to be distributed as a proportions of their label size, hence we&#39;ll choose <code>Fill Proportionally</code>.</li>
<li>Spacing - is redundant here since Our Distribution defines the way the items will be spaced.</li>
</ul>
<p class="image-container"><img alt="Info Stack View" src="img/dc5c5cf42aa35f36.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Adding Current Weather - Description UI Elements" duration="0">
        <p>We&#39;ll add the items as in the image below.<br><img alt="CurrentWeather-Description" src="img/760887a2631dee64.png"></p>
<p>Follow these steps in order to add the items:</p>
<ul>
<li>Step 1: In Object Library (<code>+</code> Button) Search For an Image: <img alt="CurrentWeather-Image" src="img/4f9d5960ab000bd0.png"></li>
<li>Step 2: Drag the image under the blue view we&#39;ve previously created.</li>
<li>Step 3: In Object Library (<code>+</code> Button) Search For a Label: <img alt="CurrentWeather-Label" src="img/824f0890ca9139fd.png"></li>
<li>Step 4: Drag the label under the blue view we&#39;ve previously created.</li>
<li>Step 5: By clicking on the Items give them meaningful names:  <ul>
<li><code>Description Image</code> for the Image</li>
<li><code>Description Label</code> for the middle Label</li>
</ul>
</li>
<li>Step 6: Your Interface builder should look like that<br><img alt="Description Interface Builder" src="img/1b9ca68733da06c6.png"></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Creating Current Weather - Description Stackview" duration="0">
        <h3 is-upgraded>Current Weather Description Stack View properties</h3>
<ul>
<li>Axis - As our elements are stacked vertically, we&#39;ll choose <code>Vertical</code>.</li>
<li>Alignment - We&#39;d like our elements to be in the Center of the container, we&#39;ll choose <code>Center</code>.</li>
<li>Distribution - We&#39;d like our elements to be vertically stretched in the container, hence, we&#39;ll choose <code>Fill</code>.</li>
</ul>
<p class="image-container"><img alt="Image Stack View" src="img/b614aa90aa4c0ce6.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Setting constraints for our Stackviews" duration="0">
        <p>Now that we have two Stackviews, we need to constraint them to the view, and each other.</p>
<h3 is-upgraded>Adding constraints to the <code>Info Stackview</code>:</h3>
<ul>
<li>Step 1: Click on the Info Stack View, then on <code>Add New Constraints</code><ul>
<li>Pin the stack view 20 pts to the top of the view</li>
<li>Pin the stack view 20 pts to the bottom of the view</li>
<li>Pin the stack view 20 pts to the leading edge of the view</li>
</ul>
</li>
<li>Step 2: We still need a constrain to the trailing edge,  <ul>
<li>We&#39;ll solve that by adding constraints to the Description stack view.</li>
</ul>
</li>
</ul>
<h3 is-upgraded>Adding constraints to the <code>Description Stack View</code>:</h3>
<ul>
<li>Step 1: Click on the Description Stack View then on <code>Add New Constraints</code><ul>
<li>Pin the stack view 100 pts to the top of the view</li>
<li>Pin the stack view 20 pts to the bottom of the view</li>
<li>Pin the stack view 20 pts to the trailing of the view</li>
</ul>
</li>
<li>Step 2: Add a constrain related to the Info stack view:  <ul>
<li>The constrain should reflect that the leading Image Stack View will be 20 pts from the trailing edge of the Info Stack View</li>
</ul>
</li>
</ul>
<p>Your constraints should look as following:<br><img alt="Stack View Constraints" src="img/772a9464ef352cec.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Adding Assets to our Project" duration="0">
        <p>As part of our data model, we&#39;ll parse the weather description, and map it to a local asset.<br> In order to do so, go ahead and <a href="https://github.com/zivz/weatherapp_codelab/raw/master/resources/UI_Assets.zip" target="_blank">Download Image Assets</a></p>
<p>Once a weather description will be parsed, it will be associated to a local image in our assets and then will be displayed to our user.</p>
<p>In order to import the resources to our project, simply go to <code>Assets.xcassets</code> folder and drag the images after being extracted from the attached zip.</p>


      </google-codelab-step>
    
      <google-codelab-step label="MVC Design Pattern" duration="0">
        <p>Apple&#39;s recommended architectural pattern, Model-View-Controller or MVC for short.<br> MVC is a software development pattern made up of three main objects:</p>
<ul>
<li>The <strong>Model</strong> is where your data resides. in our case the model will be things like:<ul>
<li>The networking code.</li>
<li>Managers like our location manager.</li>
<li>Model Objects, such as our CurrentWeather object.</li>
</ul>
</li>
<li>The <strong>View</strong> Layer is the face of our app. Its classes are reusable as they don&#39;t contain any domain-specific logic. For example, a <code>UILabel</code> is a view that represents a text on the screen, and it&#39;s reusable. In our case, our view will be coupled with our controller.</li>
<li>The <strong>Controller</strong> mediates between the view and the model. In our case, we&#39;ll not have any user-interaction, but instead request for data from our API, use our model, and update the view, using our controller.</li>
</ul>
<p class="image-container"><img alt="MVC Diagram" src="img/29f23cdaeee308c5.png"></p>
<p>Resources:</p>
<ul>
<li><a href="https://www.raywenderlich.com/1000705-model-view-controller-mvc-in-ios-a-modern-approach" target="_blank">raywanderlich.com</a></li>
<li><a href="https://learnappmaking.com/model-view-controller-mvc-swift/" target="_blank">learnappmaking.com</a><br></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Preparing our Network Manager - Part 1" duration="0">
        <p>Before we begin go to our project navigator, and create a new group, named <code>Managers</code>. In order to so, right click on Weather App Folder and Choose <code>Create New Group</code> A group in Xcode was used to be a &#34;FAKE&#34; folder, but now a days a group is actually a folder. A group without folder is used in order to organize files in your project without affecting the structure on the actual file system.</p>
<p>You can read more about groups and folder in <a href="https://stackoverflow.com/questions/34207664/difference-between-folder-and-group-in-xcode" target="_blank">stackoverflow.com</a></p>
<p>Follow these steps in order to create our Network Manager file:</p>
<ol type="1">
<li>Right click our new group, named <code>Network Manager</code> c</li>
<li>Choose New file..</li>
<li>Choose <code>Swift</code></li>
<li>name it <code>NetworkManager.swift</code></li>
</ol>
<h3 is-upgraded>Open Weather API</h3>
<p>In order to fetch data from the network, we&#39;ll be using open weather api. Feel free to self explore the API, but for now we&#39;ll use the <code>Current Weather API</code> only.</p>
<p>In order to get the current weather, there are several options:</p>
<ul>
<li>Get the weather by city name</li>
<li>Get the weather by city id</li>
<li>Get the weather by geographic coordinates. <strong>This is the request we&#39;ll be using</strong></li>
<li>Get the weather by zip code</li>
</ul>
<h3 is-upgraded>Getting weather by geographic coordinates</h3>
<p>As specified in <a href="https://openweathermap.org/current" target="_blank">Current Weather API</a><br> We&#39;ll need to pass the network call the latitude and longitude coordinates, as well as an api key. In order to create an api key, you&#39;ll be required to <a href="https://openweathermap.org/appid" target="_blank">Subscribe</a> to Open weather API.</p>
<p>The API call will look as so:<br><code>api.openweathermap.org/data/2.5/weather?lat={lat}&amp;lon={lon}&amp;appid={your api key}</code></p>
<h3 is-upgraded>Creating a structure for our End Point</h3>
<p>In <code>NetworkManager.swift</code> We&#39;ll insert a structure for our end point. The structure is using URL Components, will save us typos, bugs and will be easier to use, later in our API Calls. The structure is based on <a href="https://www.swiftbysundell.com/articles/constructing-urls-in-swift" target="_blank">Constructing URLs in Swift article</a></p>
<p>go ahead and copy these lines to our <code>NetworkManager.swift</code></p>
<pre><code>private struct EndPoints {
    private struct Path {
        static let weather = &#34;/data/2.5/weather&#34;
    }

    private static let base_url = &#34;api.openweathermap.org&#34;

    private struct QueryParams {
        static let latitude = &#34;lat&#34;
        static let longitude = &#34;lon&#34;
        static let app_id = &#34;appid&#34;
        static let mode = &#34;mode&#34;
        static let units = &#34;units&#34;
    }

    private struct QueryValues {
        static let api_key = &#34;insert your apikey&#34;
        static let units = &#34;metric&#34;
        static let latitude = Location.shared.latitude!
        static let longitude = Location.shared.longitude!
    }

    static var currentWeatherURL: URL? {
        var components = URLComponents()
        components.scheme = &#34;https&#34;
        components.host = EndPoints.base_url
        components.path = Path.weather
        components.queryItems = [
            URLQueryItem(name: QueryParams.latitude, value: String(Location.shared.latitude!)),
            URLQueryItem(name: QueryParams.longitude, value: String(Location.shared.longitude!)),
            URLQueryItem(name: QueryParams.app_id, value: QueryValues.api_key),
            URLQueryItem(name: QueryParams.units, value: QueryValues.units)
        ]

        return components.url

    }
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Preparing our Network Manager - Part 2" duration="0">
        <p>Will now create our Network Manager, the Network Manager is a singleton.</p>
<h3 is-upgraded>Create our singleton</h3>
<p>Copy these lines of code, under our EndPoints structure.</p>
<pre><code>class NetworkManager {
  static let shared = NetworkManager()
  private init() {}
}
</code></pre>
<p>By using private init() our NetworkManager cannot be instantiated more than once, hence, it&#39;s a singleton.</p>
<h3 is-upgraded>Creating our currentWeather Network Call</h3>
<p>Our network call will not get any outside parameters, but rather be using our location coordinates, which will be accessed through a singleton as well. We&#39;ll use the enumeration to capture information about whether an asynchronous call succeeds or fails, and use the associated values for the <code>Result.success(_:)</code> and <code>Result.failure(_:)</code> cases to carry information about the result of the call. To read more about using result, I&#39;ve found <a href="https://www.hackingwithswift.com/articles/161/how-to-use-result-in-swift" target="_blank">this article</a> very helpful.</p>
<p>Go ahead an declare our function under <code>private init() {}</code> declaration.</p>
<pre><code>func getCurrentWeather(completionHandler: @escaping (Result&lt;CurrentWeather, WeatherError&gt;) -&gt; Void ) {

}
</code></pre>
<p>Notice that we&#39;re using our CurrentWeather, and WeatherError as the success and failure cases. We&#39;ll create the <code>Current Weather Model</code> and <code>WeatherError</code> very soon.</p>
<h3 is-upgraded>Creating our data task</h3>
<p>Our data task, which will handle the api call will be consisted from constructing the url, firing the request and handling the response.</p>
<p>Let&#39;s create the url</p>
<p>in our function, copy and paste these lines of code:</p>
<pre><code>guard let url = EndPoints.currentWeatherURL else {
    completionHandler(.failure(.invalidURL))
    return
}
</code></pre>
<p>This part was easy, since we were using our EndPoints structure. We also had to handle an error, since the url is optional and we don&#39;t want to continue if the url is <code>nil</code>. In that case we&#39;ll return a failure case, the failure case is expecting an error, so we provided our WeatherError enum with invalidUrl.</p>
<p>Let&#39;s fire our task, will be using URLSession.<br> URLSession provides and API for downloading data from and uploading data to endpoints indicated by URLs. You can read more about URLSession <a href="https://developer.apple.com/documentation/foundation/urlsession" target="_blank">here</a>, <a href="https://www.raywenderlich.com/3244963-urlsession-tutorial-getting-started" target="_blank">here</a> and <a href="https://learnappmaking.com/urlsession-swift-networking-how-to/" target="_blank">here</a></p>
<p>under our guard statement, copy and paste this line of code</p>
<pre><code>let task = URLSession.shared.dataTask(with: url) { data, response, error in

}
</code></pre>
<p>We now see that our dataTask, using the url we&#39;ve created, the completionHandler of the task either returns us data, response and error.</p>
<h3 is-upgraded>Handling the error</h3>
<p>error means there was a transport error, either by sending the request, or receiving the response.</p>
<p>to handle the error copy and paste these lines of code:</p>
<pre><code>if let _ = error {
    completionHandler(.failure(.unableToComplete))
    return
}
</code></pre>
<h3 is-upgraded>Handling the response</h3>
<p>We&#39;re expecting for response code of 200, so any other response code will indicate us an error. to handle responses other than 200, copy and paste these lines of code:</p>
<pre><code>guard let response = response as? HTTPURLResponse, response.statusCode == 200 else {
    completionHandler(.failure(.unableToComplete))
    return
}
</code></pre>
<h3 is-upgraded>Handling our data</h3>
<p>We&#39;re expecting for data, so we&#39;ll again handle the case we don&#39;t get any data. to handle corrupted data, copy and paste these lines of code:</p>
<pre><code>guard let data = data else {
    completionHandler(.failure(.invalidData))
    return
}
</code></pre>
<h3 is-upgraded>Decoding our data</h3>
<p>We&#39;ll be using JSONDecoder, since our data will be serialized to JSON, Then we&#39;d like to parse our JSON into an object, which will be our DecodedWeather structure. We&#39;ll then map for our own convenience DecodedWeather to CurrentWeather which will contain the data in the structure we want.</p>
<p>go ahead and copy these lines of code under data closing braces:</p>
<pre><code>do {
    let decoder = JSONDecoder()
    let decodedWeather = try decoder.decode(DecodedWeather.self, from: data)
    let currentWeather = CurrentWeather(weather: decodedWeather)
    completionHandler(.success(currentWeather))
} catch {
    completionHandler(.failure(.invalidData))
}
</code></pre>
<h3 is-upgraded>Firing the request</h3>
<p>After the closing braces of our task, insert <code>task.resume()</code> This line of code will fire our request.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Preparing our Data model" duration="0">
        <p>After fetching our data, using the getCurrentWeather request, we&#39;ll be using JSON decoder and get our object in hand. We&#39;ll use decodable for parsing our data. Then map our structure to another structure, for our own convenience.</p>
<h3 is-upgraded>Creating a group for our data model</h3>
<p>In order to so, right click on Weather App Folder and Choose <code>Create New Group</code> Name the group <code>Model</code></p>
<p>Follow these steps in order to create our Network Manager file:</p>
<ol type="1">
<li>Right click our new group, named <code>Model</code></li>
<li>Choose New file..</li>
<li>Choose <code>Swift</code></li>
<li>Name it <code>CurrentWeather.swift</code></li>
</ol>
<p>By examining our response, we need to decode the following pieces:</p>
<p>from the first hierarchy we&#39;ll need:</p>
<ul>
<li>&#34;name&#34; for the Location label</li>
</ul>
<p>from weather structure, we&#39;ll need:</p>
<ul>
<li>&#34;main&#34; for weather description and image.</li>
</ul>
<p>from main structure, we&#39;ll need:</p>
<ul>
<li>&#34;temp&#34; for weather description.</li>
</ul>
<p>The current date label will not be taken from the network response.</p>
<pre><code>{
    &#34;coord&#34;: {
        &#34;lon&#34;: 34.91,
        &#34;lat&#34;: 31.99
    },
    &#34;weather&#34;: [
        {
            &#34;id&#34;: 802,
            &#34;main&#34;: &#34;Clouds&#34;,
            &#34;description&#34;: &#34;scattered clouds&#34;,
            &#34;icon&#34;: &#34;03d&#34;
        }
    ],
    &#34;base&#34;: &#34;stations&#34;,
    &#34;main&#34;: {
        &#34;temp&#34;: 20.12,
        &#34;feels_like&#34;: 16.12,
        &#34;temp_min&#34;: 17.78,
        &#34;temp_max&#34;: 21.67,
        &#34;pressure&#34;: 1019,
        &#34;humidity&#34;: 46
    },
    &#34;visibility&#34;: 10000,
    &#34;wind&#34;: {
        &#34;speed&#34;: 5.1,
        &#34;deg&#34;: 290
    },
    &#34;clouds&#34;: {
        &#34;all&#34;: 43
    },
    &#34;dt&#34;: 1582806769,
    &#34;sys&#34;: {
        &#34;type&#34;: 1,
        &#34;id&#34;: 6845,
        &#34;country&#34;: &#34;IL&#34;,
        &#34;sunrise&#34;: 1582776663,
        &#34;sunset&#34;: 1582817744
    },
    &#34;timezone&#34;: 7200,
    &#34;id&#34;: 294421,
    &#34;name&#34;: &#34;Lod&#34;,
    &#34;cod&#34;: 200
}
</code></pre>
<h3 is-upgraded>Decoding the Current Weather</h3>
<p>In <code>CurrentWeather.swift</code>, copy and paste.</p>
<pre><code>// MARK: - CurrentWeather
struct DecodedWeather: Decodable {

    let weather: [Weather]
    let main: Main
    let cityName: String

    enum CodingKeys: String, CodingKey {
        case weather, main
        case cityName = &#34;name&#34;
    }
}

// MARK: - Main
struct Main: Decodable {
    let temp: Double
}

// MARK: - Weather
struct Weather: Decodable {
    let type: String

    enum CodingKeys: String, CodingKey {
        case type = &#34;main&#34;
    }
}
</code></pre>
<h3 is-upgraded>Mapping DecodedWeather to CurrentWeather</h3>
<p>Let&#39;s go ahead and create  <code>CurrentWeather</code> structure, that will be used for mapping the decoded response for our convenience.</p>
<pre><code>struct CurrentWeather: Codable {

    let currentTemp: Int
    let weatherType: String
    let cityName: String

    init(weather: DecodedWeather) {
        self.currentTemp = Int(weather.main.temp.rounded(.toNearestOrEven))
        self.weatherType = weather.weather.first?.type ?? &#34;&#34;
        self.cityName = weather.cityName
    }
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Creating Location Model" duration="0">
        <p>In order to save the location, retrieved by <code>Core Location</code> and upon <code>When in use authorization</code> permission<br> we&#39;ll create another file for saving the <code>Location</code> Model.</p>
<p>Follow these steps in order to create our Location file:</p>
<ol type="1">
<li>Right click our new group, named <code>Utilities</code></li>
<li>Choose New file..</li>
<li>Choose <code>Swift</code></li>
<li>Name it <code>Location.swift</code></li>
</ol>
<p>Add the following code, so we&#39;ll have Location as singleton, we&#39;ll also need to save only two attributes, which are the <code>latitude</code> and <code>longitude</code>.</p>
<pre><code>class Location {
    static var shared = Location()

    private init() {}

    var latitude: Double!
    var longitude: Double!
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Creating WeatherError" duration="0">
        <p>In order to handle the various cases of network errors, we&#39;ll create a new group, named <code>Utilities</code>.</p>
<p>Follow these steps in order to create our WeatherError file:</p>
<ol type="1">
<li>Right click our new group, named <code>Utilities</code></li>
<li>Choose New file..</li>
<li>Choose <code>Swift</code></li>
<li>Name it <code>WeatherError.swift</code><br></li>
</ol>
<p>create the following cases by copy and pasting these lines of code:</p>
<pre><code>enum WeatherError: String, Error {
    case invalidResponse = &#34;Invalid response from the server&#34;
    case invalidURL = &#34;Invalid url&#34;
    case unableToComplete = &#34;Unable to complete your request. Please check your internet connection&#34;
    case invalidData = &#34;The data received from the server was corrupted. Please try again&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Date Formatting" duration="0">
        <p><code>Swift</code> Foundation provides us to get the current date. This is required in order to display the current date label, but the format we&#39;ll be using doesn&#39;t match our needs.</p>
<p>We&#39;ll create an extension for <code>Date</code> and use it to display the date in the format we want.</p>
<p>Create a new group, named <code>Extensions</code> Follow these steps in order to create our Date+Ext file:</p>
<ol type="1">
<li>Right click our new group, named <code>Extensions</code></li>
<li>Choose New file..</li>
<li>Choose <code>Swift</code></li>
<li>Name it <code>Date+Ext.swift</code><br></li>
</ol>
<p>Using <a href="https://nsdateformatter.com" target="_blank">this web site</a>, allows to easily deal with formatting. Since we want our Date to Include Month, day and year we&#39;ll play with the format in the above link and copy the format.<br> ![Date Format][./assets/DateFormat.png]</p>
<p>in our file, insert the following code:</p>
<pre><code>func currentDate() -&gt; String {
    let dateFormatter = DateFormatter()
    dateFormatter.dateFormat = &#34;MMMM dd, yyyy&#34;
    let currentDate = dateFormatter.string(from: Date())
    return &#34;Today, \(currentDate)&#34;
}
</code></pre>
<p>Alternatively we can use this code, I&#39;ve found while searching in <a href="https://stackoverflow.com/questions/24100855/set-a-datestyle-in-swift" target="_blank">stackoverflow</a></p>
<pre><code>func currentDate() -&gt; String {
    let dateFormatter = DateFormatter()
    dateFormatter.dateStyle = .long
    dateFormatter.timeStyle = .none
    let currentDate = dateFormatter.string(from: Date())
    return &#34;Today, \(currentDate)&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Connecting the UI To Our View controller" duration="0">
        <p>In order to control our UI elements and handle the logic related to them, we need to connect our UI to a View Controller. Currently our <code>Main.storyboard</code> has a scene, named <code>View Controller Scene</code>, and by viewing its Identity Inspector we see its class is <code>ViewController.swift</code>.</p>
<p>Positive: <strong>Reminder:</strong> Having Main.storyboard and a ViewController associated to it, came out of the box, since we created a <code>Single View</code> Template while we created the project.</p>
<p>Negative: <code>ViewController.swift</code> class has no code related to our logic, and even before we start writing any code in it, its name doesn&#39;t reflect its responsibility.  So before we start connecting our UI Elements to the ViewController we&#39;ll first rename it.</p>
<h3 is-upgraded>Renaming our View controller</h3>
<p>In order to rename our view controller follows these steps:</p>
<ol type="1">
<li>In Project Navigator click on <code>ViewController.swift</code></li>
<li>Click again, and rename to <code>WeatherVC.swift</code></li>
<li>Open the file and change the class name:  <ul>
<li>In the description heather</li>
<li>In the class declaration</li>
</ul>
</li>
<li><strong>Our Storyboard doesn&#39;t know who&#39;s WeatherVC</strong>, Open <code>Main.storyboard</code><ul>
<li>Click on the View Controller Scene</li>
<li>In utilities pane click on <code>identity inspector</code><br><img alt="Identity Inspector" src="img/110db191fb3c3bcc.png"></li>
<li>Change the class in custom class to <code>WeatherVC</code></li>
</ul>
</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Connecting outlets from interface builder" duration="0">
        <h3 is-upgraded>Showing our View Controller Scene aside of our View Controller</h3>
<p>In order that <code>WeatherVC</code> will handle the logic for our UI Elements we need to connect them to our class.<br> Before we start doing that we&#39;ll prepare Xcode and change the layout so we can view the elements and the code side by side.</p>
<p>In order to view <code>WeatherVC</code> side by side with our storyboard, follow these steps:</p>
<ul>
<li>Open <code>Main.storyboard</code></li>
<li>In editor view - click on <code>Adjust Editor Options</code> button.<br><img alt="Adjust Editor Options" src="img/36dbf6f2ae5a5806.png"></li>
<li>Choose <code>Assistant</code></li>
<li>Our <code>Main.storyboard</code> should open the View Controller associated with the scene that is currently in focus. Since We have only one scene, and only one View Controller, it will open WeatherVC.Swift on the side.</li>
</ul>
<h3 is-upgraded>Creating outlets for our UI Elements</h3>
<p>Connecting our UI Elements in <code>WeatherVC Scene</code> to our <code>WeatherVC</code> class, requires an Interface Builder outlet. Creating an outlet is simple as dragging our element to the code.</p>
<p>In order to create an outlet follow these steps:</p>
<ul>
<li>Open document outline and select the UI element, let&#39;s start with our <code>Date Label</code>.</li>
<li>Drag the element when holding the <code>^</code>/<code>Ctrl</code> button to <code>WeatherVC.swift</code></li>
<li>When the dialog opens, choose connection as <code>Outlet</code></li>
<li>Give the outlet a meaningful name, such as <code>dateLabel</code></li>
<li>Verify the type is as expected UILabel for label, or UIImageView for Image view.</li>
<li>Verify the reference is weak.<br><img alt="Outlet" src="img/c6a7c098437d4ee7.gif"></li>
<li><strong>Repeat The steps above for all our elements</strong> :  <ul>
<li><code>Current Temp Label</code></li>
<li><code>Location Label</code></li>
<li><code>Current Weather Image</code></li>
<li><code>Current Weather Type Label</code></li>
</ul>
</li>
</ul>
<h3 is-upgraded>Verify your connections</h3>
<p>By using the <code>utilities</code>/<code>inspectors</code> pane, we can use the connections inspector to verify everything is in place:</p>
<ul>
<li>Choose our View Controller Scene, e.g, <code>WeatherVC Scene</code><br></li>
<li>Reveal the Utilities pane by clicking on the right button.<br><img alt="UtilitiesPane" src="img/5bf8bcbea69defe8.png"></li>
<li>Click on the right most button, which the connections inspector.</li>
<li>You should see all our connections, I&#39;ve marked those you should be familiar with in the rectangular area. <img alt="ConnectionsInspector" src="img/c55b02944097d9f.png"></li>
<li>verify the all your connections appears with a filled circle.<br></li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
